# AirFuture X-Operator Governance & Maintenance Rules v1.0

## 1. ディレクトリ構造の厳守 (Directory Structure)
- **ソースコードの正会員**: すべての実行コード、設定ファイル、静的アセットは **`04_code/`** ディレクトリ内に配置すること。
- **リポジトリルート**: ルート直下には `04_code/` フォルダ、`README.md`、`GOVERNANCE.md` のみを置く運用とする。
- **理由**: Vercelの「Root Directory」設定が `04_code` に固定されており、これを無視してルートにファイルを置くとデプロイエラー（404）が発生するため。

## 2. Vercel 設定ルールの厳守 (Vercel Config Rules)
- **`vercel.json`**: 必ず `04_code/vercel.json` を編集すること。
- **ルーティング**: 新しいAPIやページを追加する場合、以下のルールに従う。
  - `source`: ユーザーがアクセスする拡張子なしのパス（例: `/admin`）
  - `destination`: 実際のファイルパス。APIの場合は拡張子 `.js` を除外すること（例: `/api/cron`）。これを除外しないと、Lambda関数として実行されずにソースコードがテキストとして露出するリスクがある。

## 3. 開発・修正フロー (Development Flow)
- **修正前点検**: 修正を行う前に、必ず `04_code/docs/VERCEL_SETUP.md` を読み、現在のデプロイ構成を理解すること。
- **反映**: GitHubへのプッシュ後、`https://x-autoup.vercel.app/api/ping` 等で疎通確認を必ず行うこと。
- **管理画面の多重リポジトリ同期**: 
    - 管理画面 (`admin.html`) の修正時は、必ず **システムリポジトリ (`x-autoup`)** と **LPリポジトリ (`af-mini-specialLP`)** の両方を最新状態に保たなければならない。
    - 片方の修正だけで作業を終了することは、運用の矛盾（バージョン乖離）を招くため「重大な保守ミス」とみなす。
- **破壊的変更の禁止**: 万一ファイルを移動したりフォルダ構成を変えたりする場合は、必ずVercelの管理画面設定と同期させること。

## 4. AI エージェントへの指示 (Instruction for AI Agents)
- あなたがこのプロジェクトのコードを修正する際は、**作業対象を `04_code/` フォルダ下に限定**してください。
- ユーザーに確認せずにルートディレクトリに新しいフォルダやファイルをバラ撒くことは、デプロイ破壊につながるため、**厳禁**とします。

## 5. タイムゾーン & 定時処理の厳格ルール (Timezone & Datetime Policy) v1.1
- **基本原則**: すべての内部処理、ログ記録、ダッシュボード表示は **日本時間 (JST / UTC+9)** を基準とする。
- **環境依存の禁止**: Vercel等のサーバー環境はデフォルトで UTC です。`new Date()` をそのまま日付判定に使用してはならない。
- **具体的実装指示**:
    - **パース**: スプレッドシートからの日付文字列読み込み時は、必ず末尾に `+09:00` を付与してパースすること。
        - 例: `new Date(ts_str.replace(' ', 'T') + '+09:00')`
    - **日付判定**: 「本日」や「統計期間」の境界（00:00:00）は、JSTの0時で判定すること。午前9時前の投稿が「昨日」扱いになるバグを絶対に防ぐこと。
    - **集計ロジック**: `posted_today` 等の集計には、`getJstDateStr` 等のヘルパー関数を用いて、文字列レベルで日付を比較することを推奨する。
- **検証項目**: 修正後は、**日本時間の午前1:00〜8:00の間**に「本日」の集計（KPI）が正しく機能するかをシミュレーションまたは実地で確認すること。
