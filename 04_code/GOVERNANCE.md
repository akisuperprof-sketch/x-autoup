# AirFuture X-Operator Governance & Maintenance Rules v1.1 (Human-Likeness Enforced)

## 1. ディレクトリ構造の厳守 (Directory Structure)
- **ソースコードの正会員**: すべての実行コード、設定ファイル、静的アセットは **`04_code/`** ディレクトリ内に配置すること。
- **リポジトリルート**: ルート直下には `04_code/` フォルダ、`README.md`、`GOVERNANCE.md` のみを置く運用とする。
- **理由**: Vercelの「Root Directory」設定が `04_code` に固定されており、これを無視してルートにファイルを置くとデプロイエラー（404）が発生するため。

## 2. Vercel 設定ルールの厳守 (Vercel Config Rules)
- **`vercel.json`**: 必ず `04_code/vercel.json` を編集すること。
- **ルーティング**: 新しいAPIやページを追加する場合、以下のルールに従う。
  - `source`: ユーザーがアクセスする拡張子なしのパス（例: `/admin`）
  - `destination`: 実際のファイルパス。APIの場合は拡張子 `.js` を除外すること（例: `/api/cron`）。これを除外しないと、Lambda関数として実行されずにソースコードがテキストとして露出するリスクがある。

## 3. 開発・修正フロー (Development Flow)
- **修正前点検**: 修正を行う前に、必ず `04_code/docs/VERCEL_SETUP.md` を読み、現在のデプロイ構成を理解すること。
- **反映**: GitHubへのプッシュ後、`https://x-autoup.vercel.app/api/ping` 等で疎通確認を必ず行うこと。
- **管理画面の多重リポジトリ同期**: 
    - 管理画面 (`admin.html`) の修正時は、必ず **システムリポジトリ (`x-autoup`)** と **LPリポジトリ (`af-mini-specialLP`)** の両方を最新状態に保たなければならない。
    - 片方の修正だけで作業を終了することは、運用の矛盾（バージョン乖離）を招くため「重大な保守ミス」とみなす。
- **破壊的変更の禁止**: 万一ファイルを移動したりフォルダ構成を変えたりする場合は、必ずVercelの管理画面設定と同期させること。

## 4. AI エージェントへの指示 (Instruction for AI Agents)
- あなたがこのプロジェクトのコードを修正する際は、**作業対象を `04_code/` フォルダ下に限定**してください。
- ユーザーに確認せずにルートディレクトリに新しいフォルダやファイルをバラ撒くことは、デプロイ破壊につながるため、**厳禁**とします。

## 5. タイムゾーン & 定時処理の厳格ルール (Timezone & Datetime Policy) v1.1
- **基本原則**: すべての内部処理、ログ記録、ダッシュボード表示は **日本時間 (JST / UTC+9)** を基準とする。
- **環境依存の禁止**: Vercel等のサーバー環境はデフォルトで UTC です。`new Date()` をそのまま日付判定に使用してはならない。
- **具体的実装指示**:
    - **パース**: スプレッドシートからの日付文字列読み込み時は、必ず末尾に `+09:00` を付与してパースすること。
        - 例: `new Date(ts_str.replace(' ', 'T') + '+09:00')`
    - **日付判定**: 「本日」や「統計期間」の境界（00:00:00）は、JSTの0時で判定すること。午前9時前の投稿が「昨日」扱いになるバグを絶対に防ぐこと。
    - **集計ロジック**: `posted_today` 等の集計には、`getJstDateStr` 等のヘルパー関数を用いて、文字列レベルで日付を比較することを推奨する。
- **検証項目**: 修正後は、**日本時間の午前1:00〜8:00の間**に「本日」の集計（KPI）が正しく機能するかをシミュレーションまたは実地で確認すること。

## 6. 厳格なペルソナ維持 & メタデータ混入防止 (Strict Persona & Metadata Policy)
- **絶対禁忌**: 投稿本文（draft）に、システム内部用のラベル、タグ、IDを**1文字たりとも混入させてはならない**。
    - 禁止例: `【AEO対策】`, `【検証結果】`, `[id:xxxx]`, `(A案)` などのカッコ類・識別子。
- **目的**: 視聴者に「AIの自動生成」であることを悟らせず、専門スタッフによる血の通った発信としての信頼（Trust）を守り抜くため。
- **実装ルール**:
    - **プロンプト指示**: AI生成器（Generate API）の指示には、常に「内部タグの含入禁止」を最優先事項として含めること。
    - **重複回避の処理**: Twitterの重複投稿制限を避けるための識別子は、必ず **「ゼロ幅スペース (\u200B)」等の非可視文字** を使用すること。ユーザーの目に触れる文字での差別化は厳禁とする。
    - **既存データの修正**: 上記の混入が発覚した場合、即座に対象投稿を「deleted」または「cancel」とし、公開を阻止すること。
 
+## 7. 人間らしさの絶対正義 (Uniqueness & Human-Likeness Guardian)
+- **憲法の制定**: [SPECIFICATION.md](./SPECIFICATION.md) v6.1 以降に記載された「AI生成・運用ルール」を、本システムの**最高法規（憲法）**として制定する。
+- **物理的重複排除 (The 10-Chars Law)**:
+    - 過去の全投稿内容の **「前方10文字」** を例外なくデータベースから照合し、1文字でも一致した場合は、その記事の採用を禁止する。 AI生成器は合格するまで再生成を繰り返し、物理的に「過去の自分」を模倣させない。
+- **ボット判定回避の3箇条**:
+    1. **ハッシュタグの完全封印**: どのような理由があっても、公開記事（draft）にハッシュタグ（#）を含めてはならない。
+    2. **絵文字のデフレーション**: 1投稿につき絵文字は最大1つまで。AI特有の「キラキラした過剰装飾」は排除する。
+    3. **文頭（フック）の強制多様化**: 問いかけ、嘆嘆、静かな気づき、時間描写など、文末だけでなく「文頭のパターン」を不規則に変化させること。
+- **トピックの動的ローテーション**:
+    - 特定の話題（花粉のみ等）への固執を禁止する。生成のたびに、システムが定義した複数の専門カテゴリー（3Dプリンター、ペット、睡眠、仕事、技術、最新トレンド等）からランダムに、かつ均等に視点を選択すること。
+
+---
+このルールは「信頼（Trust）の最大化」を唯一の目的としており、効率化やコスト削減のために例外を認めることは、システムの崩壊と同義である。
+
